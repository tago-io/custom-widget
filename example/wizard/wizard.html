<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wizard example</title>
  <link href="./steps.css" rel="stylesheet" type="text/css" />
  <script src="../../dist/customWidget.js"></script>
</head>
<body>
  <div id="root">
    <form id="regForm" action="">

      <h1>Wizard example:</h1>
      
      <!-- TAB 1 -->
      <div class="tab" id="#tab1">

        <div class="form-group">
          <label for="key">Key account</label>
          <input id="key">
        </div>
        <div class="form-group">
          <label for="venue">Venue</label>
          <select class="select" id="venue" onchange="changeTab2()">
          </select>
        </div>

      </div>
      
      <!-- TAB 2 -->
      <div class="tab" id="#tab2">

        <!-- SCREEN 1 -->
        <div id="screen1">
          <div class="form-group">
            <label for="sa">Serving area</label>
            <input id="sa">
          </div>
          <div class="form-group">
            <label for="font">Font</label>
            <input id="font">
          </div>
        </div>

        <!-- SCREEN 2 -->
        <div id="screen2" style="display: none;">
          <div class="form-group">
            <label for="tap">Tap#</label>
            <input id="tap">
          </div>
        </div>

      </div>
      
      <!-- TAB 3 -->
      <div class="tab" id="#tab3">

        <div class="form-group">
          <label for="brand">Brand</label>
          <input id="brand">
        </div>
        <div class="form-group">
          <label for="front">Front Playlist</label>
          <input id="front">
        </div>
        <div class="form-group">
          <label for="rear">Rear Playlist</label>
          <input id="rear">
        </div>

      </div>

      <!-- the sendData response will be placed here -->
      <div class="result" style="text-align: center;margin-bottom: 20px;"></div>
      
      <div style="overflow:auto;" class="buttonGroup">
        <div style="float:right;">
          <button type="button" class="btn" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
          <button type="button" class="btn" id="nextBtn" onclick="nextPrev(1)">Next</button>
        </div>
      </div>
      
      <!-- Circles which indicates the steps of the form: -->
      <div style="text-align:center;margin-top:40px;">
        <span class="step"></span>
        <span class="step"></span>
        <span class="step"></span>
      </div>
      
    </form>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
  <script src="./wizard.js"></script>
  <script>
    let variables = [];
    window.onload = (event) => {
      TagoIO.onStart((widget) => {
        console.log("widget", widget);
      });

      TagoIO.onRealtime((data) => {
        if (data && data.result) {
          variables = data.result;
          updateInputs();
        }
      });

      TagoIO.onError((error) => {
        console.log("error", error)
      });
    };

    // updates all inputs when receiving realtime
    function updateInputs() {
      if (variables) {
        $('#venue').empty();
        variables.forEach(el => {
          if (el.variable == "venue") {
            $('#venue').append(`<option value="${el.value}">${el.value}</options>`);
          } else {
            let key = $("#" + el.variable);
            if (key.length && !key.val()) {
              key.val(el.value);
            }
          }
        });
      }
    }

    // changes the screens according to the one selected in the select
    function changeTab2() {
      if ($('#venue').val() == "teste2") {
        $('#screen1').hide();
        $('#screen2').show();
      } else {
        $('#screen2').hide();
        $('#screen1').show();
      }
    }

    // send the data to tago
    function sendData() {
      // get values from inputs
      let key = $("key").val();
      let sa = $("sa").val();
      let font = $("font").val();
      let tap = $("tap").val();
      let brand = $("brand").val();
      let front = $("front").val();
      let rear = $("rear").val();
      let venue = $("venue").val();
      let variables = [
        { variable: "key", value: key },
        { variable: "sa", value: sa },
        { variable: "font", value: font },
        { variable: "tap", value: tap },
        { variable: "brand", value: brand },
        { variable: "front", value: front },
        { variable: "rear", value: rear },
        { variable: "venue1", value: venue },
      ]
      $('.buttonGroup').attr('style', 'display: none');

      TagoIO.sendData(variables, { autoFill: true }, (data) => {
        $('.result').append('<p style="text-align: center">Success</p>');
        $('.result').append('<button class="btn" onclick="resetForm()">Reset</button>');
      })
    }
  </script>
</body>
</html>